# 策略回测使用说明

## 页面入口
在「指数分析」页面下方的「策略回测」区域。

## 参数说明
- 选择指数：需要回测的指数
- 开始日期/结束日期：不填则使用该指数在库中可用的全部日期
- 初始资金：回测起始资金
- 策略类型：
  - 定投：固定频率追加固定金额
  - 均值回归：价格偏离均线触发买卖
  - 趋势跟随：价格在均线上方买入、下方卖出

### 定投参数
- 定投金额：每次投入金额
- 定投频率：每日 / 每周 / 每月（按交易日的首日触发）

### 均值回归参数
- 均线周期：MA30/60/90/120/150/180/360
- 买入阈值(%)：价格低于均线的百分比触发买入
- 卖出阈值(%)：价格高于均线的百分比触发卖出

### 趋势跟随参数
- 趋势均线周期：MA30/60/90/120/150/180/360

## 使用步骤
1. 选择指数
2. 选择策略类型并填写参数
3. 点击「运行回测」
4. 查看结果：净值曲线、指标摘要、最近交易记录

## API 使用（可选）
### 定投
```
curl -X POST http://localhost:8000/backtest \
  -H "Content-Type: application/json" \
  -d '{
    "index_id": 1,
    "strategy": "dca",
    "initial_cash": 100000,
    "dca": { "amount": 1000, "frequency": "monthly" }
  }'
```

### 均值回归
```
curl -X POST http://localhost:8000/backtest \
  -H "Content-Type: application/json" \
  -d '{
    "index_id": 1,
    "strategy": "mean_reversion",
    "initial_cash": 100000,
    "mean_reversion": { "ma_period": 60, "buy_threshold_pct": 3, "sell_threshold_pct": 3 }
  }'
```

### 趋势跟随
```
curl -X POST http://localhost:8000/backtest \
  -H "Content-Type: application/json" \
  -d '{
    "index_id": 1,
    "strategy": "trend_following",
    "initial_cash": 100000,
    "trend_following": { "ma_period": 60 }
  }'
```

## 注意事项
- 仅使用收盘价与预计算的均线字段
- 结果为基础回测，不含手续费/滑点/分红
- 若数据不足或均线为空，策略可能无法触发交易
